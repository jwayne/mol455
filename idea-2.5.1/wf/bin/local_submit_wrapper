#!/bin/bash

#
# description:
#   This is a helper shell script for the htcserver.
# this keeps any system dependent code out of the java code.
# plus java system command support is terrible.
#   This script changes directory to the htcserver working directory 
# for the given job and then runs the sudo needed
# to submit that job to sge.

#
# Requirements for this script to work:
# 1. sudo has been setup for the htc user to submit jobs as other users
# 2. the job info directory has been setup by the htcserver with open permissions 
# 3. the sge submit file has been generated by the htcserver and is called sge_job.sh

#
# parameters:
# arg1 is the user to submit the job for.
#
# arg2 is the initial working directory for job.
#
# arg3 htcserver's job directory, this directory contains
#      the sge submit generated by htcserver and is where
#      the logs for the job will be kept
# arg4 A value of 'true' indicates that this is a marathon job
#      and a value of 'false' indicates that this is not a 
#      a marathon job. 

#
# Result
# 1. a sge job specified in sge_job.sh is submitted as user(arg1) 
# 2. sge job id is stored in sge_submit.out


# change dir to where the job submit file and logs will be stored
echo $PATH
echo $3
chmod 777 $3 
cd $3
touch event.log
chmod 666 event.log
chmod 755 sge_job.sh

# Variable that indicates if this is a marathon job (true/false)
marathon=$4

#use special sge directive
sge_directive="#SGE_DIRECTIVE"

# submit command
submit_cmd="sge_submitter.sh $marathon $2 ${3}/sge_job.sh"

$submit_cmd
